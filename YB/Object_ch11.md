# 합성과 유연한 설계

상속과 합성은 객체지향 프로그래밍에서 가장 널리 사용되는 코드 재사용 기법이다
상속 관계는 `is-a` 관계라고 부르고 합성관계는 `has-a`  관계라고 부른다
상속은 코드를 재사용할 수 있는 쉽고 간단한 방법일지는 몰라도 자식-부모클래스 사이의  결합도가 높아질 수 밖에없다
합성은 내부에 포함되는 객체의 구현이 아닌 퍼블릭 인터페이스에 의존한다.
상속 관계는 클래스 사이의 정적인 관계인 데 비해 합성 관계는 객체 사이의 동적인 관계다. 따라서 합성을 사용하면 변경이 쉽고, 유연한 설계를 얻을 수 있다.

- 화이트박스 재사용 > 서브클래싱에 의한 재사용
- 블랙박스 재사용 > 인터페이스 재사용

### 상속을 합성으로 변경하기

- 불필요한 인터페이스 상속 문제
- 메서드 오버라이딩의 오작용 문제
- 부모클래스와 자식클래스의 동시 수정 문제

상속을 합성으로 바꾸는 방법

- 자식 클래스에 선언된 상속 관계를 제거
- 부모 클래스의 인스턴스를 자식 클래스의 인스턴스 변수로 선언

### 상속으로 인한 조합의 폭발적인 증가

상속으로 인해 결합도가 높아지면 코드를 수정하는데 필요한 작업의 양이 과도하게 늘어나는 경향이 있다.

- 하나의 기능을 추가하거나 수정하기 위해 불필요하게 많은 수의 클래스를 추가하거나 수정해야 한다.
- 단일 상속만 지원하는 언어에서는 상속으로 인해 오히려 중복 코드의 양이 늘어날 수 있다.



부모 클래스의 메서드를 재사용하기 위해 super 호출을 사용하면 원하는 결과를 쉽게 얻을 수는 있지만 자식 클래스와 부모 클래스 사이의 결합도가 높아지고 만다. 

결합도를 낮추는 방법은

-  자식 클래스가 부모 클래스의 메서드를 호출하지 않도록 부모 클래스에 추상 메서드를 제공하는 것이다. 
- 자신이 정의한 추상 메서드를 호출하고 자식 클래스가 이 메서드를 오버라이딩 해서 부모 클래스가 원하는 로직을 제공하도록 수정하면 부모 클래스와 자식 클래스 사이의 결합도를 느슨하게 만들 수 있다.

부모 클래스에 추상 메서드를 추가하면 모든 자식 클래스들이 추상 메서드를 오버라이딩 해야 하는 문제가 발생한다. 자식 클래스의 수가 적다면 큰 문제가 아니겠지만 자식 클래스의 수가 많을 경우에는 꽤나 번거로운 일이 될 수 밖에 없다.
유연성은 유지하면서도 중복 코드를 제거할 수 있는 방법은 추상메서드에 대한 기본 구현(`훅 메서드`)을 함께 제공하는 것이다.

상속의 남용으로 하나의 기능을 추가하기 위해 필요 이상으로 많은 수의 클래스를 추가해야 하는 경우를 가리켜 `클래스 폭발` , `조합의폭발` 문제 라고 부른다.

### 합성 관계로 변경하기

합성은 컴파일 타임 관계를 런타임 관계로 변경함으로써 문제를 해결한다. 퍼블릭 인터페이스에 대해서만 의존할 수 있기 때문에 런타임에 객체의 관계를 변경할 수 있다.
합성을 사용하면 구현 시점에 정책들의 관계를 고정시킬 필요가 없으며 실행 시점에 정책들의 관계를 유연하게 변경할 수 있게 된다.
컴파일 의존성에 속박되지 않고 다양한 방식의 런타임 의존성을 구성할 수 있다는 것이 합성이 제공하는 커다란 장점인 것이다.

**새로운 정책 추가하기**

오직 하나의 클래스만 추가하고 런타임에 필요한 정책들을 조합해서 원하는 기능을 얻을 수 있다. 또한 요구사항을 변경할 때 오직 하나의 클래스만 수정해도 된다. 
이런 설계는 단일 책임 원칙을 준수하고 있는 것이다.

**객체 합성이 클래스 상속보다 더 좋은 방법이다.**

코드를 재사용하면서도 건전한 결합도를 유지할 수 있는 더 좋은 방법은 합성을 이용하는 것이다. 상속이 구현을 재사용하는데 비해 합성은 객체의 인터페이스를 재사용한다.

### 믹스인

합성이 상속과 같은 문제점을 초래하지 않는 이유는 클래스의 구체적인 구현이 아니라 객체의 추상적인 인터페이스에 의존하기 때문이다.

구체적인 코드를 재사용하면서도 낮은 결합도를 유지할 수 있는 유일한 방법은 재사용에 적합한 추상화를 도입하는 것이다.
`믹스인` 은 객체를 생성할 때 코드 일부를 클래스 안에 섞어 넣어 재사용하는 기법을 가리키는 용어다. 합성이 실행 시점에 객체를 조합하는 재사용 방법이라면 믹스인은 컴파일 시점에 필요한 코드 조각을 조합하는 재사용 방법이다.

**쌓을 수 있는 변경**

믹스인을 사용하면 특정한 클래스에 대한 변경 또는 확장을 독립적으로 구현한 후 필요한 시점에 차례대로 추가할 수 있다. 